<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Serial Fortran 2003 example problems &#8212; Example Programs for ARKODE  documentation</title>
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parallel Fortran 77 example problems" href="f77_parallel.html" />
    <link rel="prev" title="Parallel C++ example problems" href="cpp_parallel.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37525145-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">Example Programs for ARKODE</a>
      <span class="navbar-text pull-left"><b>v5.5.1</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Sections <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="c_serial.html">Serial C example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_openmp.html">OpenMP C example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_parallel.html">Parallel C example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_parhyp.html">Parallel Hypre example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_serial.html">Serial C++ example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_parallel.html">Parallel C++ example problems</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Serial Fortran 2003 example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="f77_parallel.html">Parallel Fortran 77 example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="f90_parallel.html">Parallel Fortran 90 example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="References.html">References</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Serial Fortran 2003 example problems</a><ul>
<li><a class="reference internal" href="#fark-diurnal-kry-bp">fark_diurnal_kry_bp</a><ul>
<li><a class="reference internal" href="#numerical-method">Numerical method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fark-roberts-dnsl">fark_roberts_dnsL</a><ul>
<li><a class="reference internal" href="#id5">Numerical method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ark-bruss">ark_bruss</a><ul>
<li><a class="reference internal" href="#id7">Numerical method</a></li>
<li><a class="reference internal" href="#solutions">Solutions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ark-bruss1d-fem-klu">ark_bruss1D_FEM_klu</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="cpp_parallel.html"
         title="previous chapter">&laquo; Parallel C++ example problems</a></li>
  <li><a href="f77_parallel.html"
         title="next chapter">Parallel Fortran 77 example problems &raquo;</a></li>
          
          
            <li></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" style="color:
  #333333; background-color: #dddddd;"/>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <section id="serial-fortran-2003-example-problems">
<span id="serial-f2003"></span><h1>Serial Fortran 2003 example problems<a class="headerlink" href="#serial-fortran-2003-example-problems" title="Permalink to this heading">¶</a></h1>
<section id="fark-diurnal-kry-bp">
<span id="id1"></span><h2>fark_diurnal_kry_bp<a class="headerlink" href="#fark-diurnal-kry-bp" title="Permalink to this heading">¶</a></h2>
<p>This problem is an ARKode clone of the CVODE problem,
<code class="docutils literal notranslate"><span class="pre">fcv_diurnal_kry_bp</span></code>.  As described in <a class="reference internal" href="References.html#hsr2017" id="id2"><span>[HSR2017]</span></a>, this problem
models a two-species diurnal kinetics advection-diffusion PDE system
in two spatial dimensions,</p>
<div class="math notranslate nohighlight">
\[\frac{\partial c_i}{\partial t} =
  K_h \frac{\partial^2 c_i}{\partial x^2} +
  V \frac{\partial     c_i}{\partial x} +
  \frac{\partial}{\partial y}\left( K_v(y)
  \frac{\partial c_i}{\partial y}\right) +
  R_i(c_1,c_2,t),\quad i=1,2\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}R_1(c_1,c_2,t) &amp;= -q_1*c_1*c_3 - q_2*c_1*c_2 + 2*q_3(t)*c_3 + q_4(t)*c_2, \\
R_2(c_1,c_2,t) &amp;=  q_1*c_1*c_3 - q_2*c_1*c_2 - q_4(t)*c_2, \\
K_v(y) &amp;= K_{v0} e^{y/5}.\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(K_h\)</span>, <span class="math notranslate nohighlight">\(V\)</span>, <span class="math notranslate nohighlight">\(K_{v0}\)</span>, <span class="math notranslate nohighlight">\(q_1\)</span>, <span class="math notranslate nohighlight">\(q_2\)</span>,
and <span class="math notranslate nohighlight">\(c_3\)</span> are constants, and <span class="math notranslate nohighlight">\(q_3(t)\)</span> and <span class="math notranslate nohighlight">\(q_4(t)\)</span>
vary diurnally.  The problem is posed on the square spatial domain
<span class="math notranslate nohighlight">\((x,y) \in [0,20]\times[30,50]\)</span>, with homogeneous Neumann
boundary conditions, and for time interval <span class="math notranslate nohighlight">\(t\in [0,86400]\)</span> sec
(1 day).</p>
<p>We enforce the initial conditions</p>
<div class="math notranslate nohighlight">
\[\begin{split}c^1(x,y) &amp;=  10^6 \chi(x)\eta(y) \\
c^2(x,y) &amp;=  10^{12} \chi(x)\eta(y) \\
\chi(x) &amp;= 1 - \sqrt{\frac{x - 10}{10}} + \frac12 \sqrt[4]{\frac{x - 10}{10}} \\
\eta(y) &amp;= 1 - \sqrt{\frac{y - 40}{10}} + \frac12 \sqrt[4]{\frac{x - 10}{10}}.\end{split}\]</div>
<section id="numerical-method">
<h3>Numerical method<a class="headerlink" href="#numerical-method" title="Permalink to this heading">¶</a></h3>
<p>We employ a method of lines approach, wherein we first semi-discretize
in space to convert the system of 2 PDEs into a larger system of ODEs.
To this end, the spatial derivatives are computed using second-order
centered differences, with the data distributed over <span class="math notranslate nohighlight">\(Mx*My\)</span>
points on a uniform spatial grid.  As a result, ARKode approaches the
problem as one involving <span class="math notranslate nohighlight">\(2*Mx*My\)</span> coupled ODEs. In this
problem, we use a relatively coarse uniform mesh with
<span class="math notranslate nohighlight">\(Mx=My=10\)</span>.</p>
<p>This program solves the problem with a DIRK method, using a Newton
iteration with the preconditioned SUNLINSOL_SPGMR iterative linear
solver module, and the ARKSPILS interface.</p>
<p>The left preconditioner used is a banded matrix, constructed using
the ARKBP module.  The banded preconditioner matrix is generated using
difference quotients, with half-bandwidths <code class="docutils literal notranslate"><span class="pre">mu</span> <span class="pre">=</span> <span class="pre">ml</span> <span class="pre">=</span> <span class="pre">2</span></code>.</p>
<p>Performance data and sampled solution values are printed at
selected output times, and all performance counters are printed
on completion.</p>
</section>
</section>
<section id="fark-roberts-dnsl">
<span id="id3"></span><h2>fark_roberts_dnsL<a class="headerlink" href="#fark-roberts-dnsl" title="Permalink to this heading">¶</a></h2>
<p>This problem is an ARKode clone of the CVODE problem,
<code class="docutils literal notranslate"><span class="pre">fcv_roberts_dnsL</span></code>.  As described in <a class="reference internal" href="References.html#hsr2017" id="id4"><span>[HSR2017]</span></a>, this problem models
the kinetics of a three-species autocatalytic reaction.  This is an
ODE system with 3 components, <span class="math notranslate nohighlight">\(Y = [y_1,\, y_2,\, y_3]^T\)</span>,
satisfying the equations,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{d y_1}{dt} &amp;= -0.04 y_1 + 10^4 y_2 y_3, \\
\frac{d y_2}{dt} &amp;= 0.04 y_1 - 10^4 y_2 y_3 - 3\cdot10^7 y_2^2, \\
\frac{d y_3}{dt} &amp;= 3\cdot10^7 y_2^2.\end{split}\]</div>
<p>We integrate over the interval <span class="math notranslate nohighlight">\(0\le t\le 4\cdot10^{10}\)</span>, with initial
conditions  <span class="math notranslate nohighlight">\(Y(0) = [1,\, 0,\, 0]^T\)</span>.</p>
<p>Additionally, we supply the following two root-finding equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}g_1(u) = u - 10^{-4}, \\
g_2(w) = w - 10^{-2}.\end{split}\]</div>
<p>While these are not inherently difficult nonlinear equations, they
easily serve the purpose of determining the times at which our
solutions attain desired target values.</p>
<section id="id5">
<h3>Numerical method<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<p>This program solves the problem with a DIRK method, using a Newton
iteration with the SUNLINSOL_LAPACKDENSE linear solver module and
ARKDLS interface.</p>
<p>As with the <a class="reference internal" href="c_serial.html#ark-robertson-root"><span class="std std-ref">ark_robertson_root</span></a> problem, we enable ARKode’s
rootfinding module to find the times at which either <span class="math notranslate nohighlight">\(u=10^{-4}\)</span>
or <span class="math notranslate nohighlight">\(w=10^{-2}\)</span>.</p>
<p>Performance data and solution values are printed at
selected output times, along with additional output at rootfinding
events.  All performance counters are printed on completion.</p>
</section>
</section>
<section id="ark-bruss">
<span id="id6"></span><h2>ark_bruss<a class="headerlink" href="#ark-bruss" title="Permalink to this heading">¶</a></h2>
<p>This test problem is a Fortran-90 version of the same brusselator
problem as before, <a class="reference internal" href="c_serial.html#ark-brusselator"><span class="std std-ref">ark_brusselator</span></a>, in which the “test 1”
parameters are hard-coded into the solver.  As with the previous test,
this problem has 3 dependent variables <span class="math notranslate nohighlight">\(u\)</span>, <span class="math notranslate nohighlight">\(v\)</span> and
<span class="math notranslate nohighlight">\(w\)</span>, that depend on the independent variable <span class="math notranslate nohighlight">\(t\)</span> via the
IVP system</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{du}{dt} &amp;= a - (w+1)u + v u^2, \\
\frac{dv}{dt} &amp;= w u - v u^2, \\
\frac{dw}{dt} &amp;= \frac{b-w}{\varepsilon} - w u.\end{split}\]</div>
<p>We integrate over the interval <span class="math notranslate nohighlight">\(0 \le t \le 10\)</span>, with the
initial conditions <span class="math notranslate nohighlight">\(u(0) = 3.9\)</span>, <span class="math notranslate nohighlight">\(v(0) = 1.1\)</span>,
<span class="math notranslate nohighlight">\(w(0) = 2.8\)</span>, and parameters <span class="math notranslate nohighlight">\(a=1.2\)</span>, <span class="math notranslate nohighlight">\(b=2.5\)</span> and
<span class="math notranslate nohighlight">\(\varepsilon=10^{-5}\)</span>.  After each unit time interval, the
solution is output to the screen.</p>
<section id="id7">
<h3>Numerical method<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h3>
<p>Since this driver and utility functions are written in Fortran-90,
this example demonstrates the use of the FARKODE interface for the
ARKode solver.  For time integration, this example uses the
fourth-order additive Runge-Kutta IMEX method, where the right-hand
sides are broken up as</p>
<div class="math notranslate nohighlight">
\[\begin{split}f_E(t,u,v,w) = \left(\begin{array}{c} a - (w+1)u + v u^2 \\
  w u - v u^2 \\ - w u  \end{array}\right), \quad\text{and}\quad
f_I(t,u,v,w) = \left(\begin{array}{c} 0\\0\\
  \frac{b-w}{\varepsilon}\end{array}\right).\end{split}\]</div>
<p>The implicit systems are solved using the built-in modified Newton
iteration, with the SUNMATRIX_DENSE matrix module and accompanying
SUNLINSOL_DENSE linear solver module, through the ARKDLS interface.
Both the Jacobian routine and right-hand side functions are supplied
by functions provided in the example file.</p>
<p>The only non-default solver options are the tolerances
<span class="math notranslate nohighlight">\(atol=10^{-10}\)</span> and <span class="math notranslate nohighlight">\(rtol=10^{-6}\)</span>, adaptivity method 2 (I
controller), a maximum of 8 Newton iterations per step, a nonlinear
solver convergence coefficient <span class="math notranslate nohighlight">\(nlscoef=10^{-8}\)</span>, and a maximum
of 1000 internal time steps.</p>
</section>
<section id="solutions">
<h3>Solutions<a class="headerlink" href="#solutions" title="Permalink to this heading">¶</a></h3>
<p>With this setup, all three solution components exhibit a rapid
transient change during the first 0.2 time units, followed by a slow
and smooth evolution, as seen in the figure below.  Note that these
results identically match those from the previous C example with the
same equations.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/plot-ark_bruss1.png"><img alt="_images/plot-ark_bruss1.png" src="_images/plot-ark_bruss1.png" style="width: 560.0px; height: 420.0px;" /></a>
</figure>
</section>
</section>
<section id="ark-bruss1d-fem-klu">
<span id="id8"></span><h2>ark_bruss1D_FEM_klu<a class="headerlink" href="#ark-bruss1d-fem-klu" title="Permalink to this heading">¶</a></h2>
<p>This problem is mathematically identical to the C example problem
<a class="reference internal" href="c_serial.html#ark-brusselator1d-fem-slu"><span class="std std-ref">ark_brusselator1D_FEM_slu</span></a>, but is written in Fortran 90, stores
the sparse Jacobian and mass matrices in compressed-sparse-row format,
and uses the KLU sparse-direct linear solver.</p>
</section>
</section>


</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2021, Daniel R. Reynolds, David J. Gardner, Carol S. Woodward, and Cody J. Balos, release number LLNL-SM-668082.<br/>
      Last updated on Jun 12, 2023.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.<br/>
    </p>
  </div>
</footer>
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>