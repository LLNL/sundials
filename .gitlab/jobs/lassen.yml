##############################################################################
# Copyright (c) 2022-24, Lawrence Livermore National Security, LLC and RADIUSS
# project contributors. See the COPYRIGHT file for details.
#
# SPDX-License-Identifier: (MIT)
##############################################################################
# ------------------------------------------------------------------------------
# SUNDIALS Copyright Start
# Copyright (c) 2002-2024, Lawrence Livermore National Security
# and Southern Methodist University.
# All rights reserved.
#
# See the top-level LICENSE and NOTICE files for details.
#
# SPDX-License-Identifier: BSD-3-Clause
# SUNDIALS Copyright End
# ------------------------------------------------------------------------------

##########################################
# Overridden shared radiuss-shared-ci jobs
##########################################

# We duplicate the shared jobs description and add necessary changes for this
# project. We keep ${PROJECT_<MACHINE>_VARIANTS} and ${PROJECT_<MACHINE>_DEPS}
# So that the comparison with the original job is easier.

# No overridden jobs so far.

########################
# Extra jobs
########################

.sundials_job_on_lassen:
  variables:
    MPIEXEC_EXECUTABLE: "jsrun"
  extends: [.custom_job, .job_on_lassen]

lassen_xl_cuda_no_tpls:
  parallel:
    matrix:
      - COMPILER_SPEC: [xl@16.1.1.14.gcc.8.3.1]
        CUDA_SPEC: [cuda@11.2.0+allow-unsupported-compilers]
  variables:
      SPEC: "%${COMPILER_SPEC} cstd=99 cxxstd=14 precision=double ~int64 +mpi+cuda cuda_arch=70 ^${CUDA_SPEC}"
  extends: [.sundials_job_on_lassen]

lassen_gcc_cuda_tpls:
  parallel:
    matrix:
      - COMPILER_SPEC: [gcc@8.3.1]
        CUDA_SPEC: [cuda@12.0.0+allow-unsupported-compilers]
  variables:
      SPEC: "%${COMPILER_SPEC} cstd=99 cxxstd=14 precision=double ~int64 +mpi+openmp+cuda+raja+magma+superlu-dist~petsc+hypre+ginkgo+kokkos cuda_arch=70 ^ginkgo+cuda cuda_arch=70 ^hypre~cuda ^superlu-dist+cuda cuda_arch=70 ^magma+cuda cuda_arch=70 ^raja+cuda~openmp~examples~exercises cuda_arch=70 ^kokkos+wrapper ^${CUDA_SPEC}"
  extends: [.sundials_job_on_lassen]

# # Benchmark job
# lassen_gcc_cuda_bench:
#   parallel:
#     matrix:
#       - COMPILER_SPEC: gcc@8.3.1
#         CUDA_SPEC: [cuda@12.0.0+allow-unsupported-compilers]
#         CALIPER_DIR: /usr/workspace/sundials/califiles
#   variables:
#     SPEC: "%${COMPILER_SPEC} cstd=99 cxxstd=14 build_type=Release precision=double scheduler=lsf caliper-dir=${CALIPER_DIR} ~int64 +benchmarks+profiling+caliper+adiak+mpi+openmp+cuda+raja cuda_arch=70 ^raja+cuda~openmp~examples~exercises cuda_arch=70 ^caliper+adiak+cuda cuda_arch=70 ^${CUDA_SPEC}"
#   extends: [.on_lassen, .build_and_bench]
